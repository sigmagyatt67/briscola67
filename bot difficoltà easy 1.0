#include <iostream>
#include <string>
#include <vector>
#include <algorithm> 
#include<ctime>
#include<cstdlib>

using namespace std;

struct mydata{
	int value;
	string segno;
};

int main(){
	int puntisq2 = 0;
	int puntisq1 = 0;
    
	
	string firstPlayer = "squadra1"; /* squadra1 inizia */
    
	auto puntiDaValore = [](int v)->int{
		if(v == 1) return 11;
		if(v == 3) return 10;
		if(v == 10) return 4;
		if(v == 9) return 3;
		if(v == 8) return 2;
		return 0;
	};

	srand((unsigned)time(NULL));

	while(true){
		cout << "\n--- Nuova mano ---\n";
		cout << "Primo a giocare in questa mano: " << firstPlayer <<endl;

		/* Leggi le due carte del bot */
		mydata botCarte[2];
		cout << " Inserisci il valore della prima carta del bot: "<<endl;
		cin >> botCarte[0].value;
		cout << " Inserisci il seme della prima carta del bot: "<<endl;
		cin >> botCarte[0].segno;
		cout << " Inserisci il valore della seconda carta del bot: "<<endl;
		cin >> botCarte[1].value;
		cout << " Inserisci il seme della seconda carta del bot: "<<endl;
		cin >> botCarte[1].segno;

		mydata primaCarta;   
		mydata secondaCarta; 

		if(firstPlayer == "squadra1"){
			// squadra1 gioca per prima, l'utente
			cout << " Inserisci il valore della carta giocata dalla squadra 1 (tavola): "<<endl;
			cin >> primaCarta.value;
			cout << " Inserisci il seme della carta giocata dalla squadra 1: "<<endl;
			cin >> primaCarta.segno;

			//  il Bot risponde scegliendo casualmente una delle sue due carte
			int cartacasuale = rand() % 2;
			secondaCarta = botCarte[cartacasuale];
			cout << " Il bot risponde con: " << secondaCarta.value << " di " << secondaCarta.segno <<endl;
		} else {
			/* bot gioca per primo */
			int cartacasuale = rand() % 2;
			primaCarta = botCarte[cartacasuale];
			cout << " Il bot gioca per primo un " << primaCarta.value << " di " << primaCarta.segno <<endl;

			/* input utente */
			cout << " Inserisci il valore della carta giocata dalla squadra 1 "<<endl;
			cin >> secondaCarta.value;
			cout << " Inserisci il seme della carta giocata dalla squadra 1 "<<endl;
			cin >> secondaCarta.segno;
		}

		/* Determina il vincitore della mano:
	 Se la seconda carta ha lo stesso seme della prima e valore maggiore, il "rispondente" vince
	 Altrimenti vince chi ha giocato per primo */
		bool responderWins = (secondaCarta.segno == primaCarta.segno && secondaCarta.value > primaCarta.value);
		string vincitore;
		if(responderWins){
			
			if(firstPlayer == "squadra1"){
				vincitore = "squadra2"; 
			} else {
				vincitore = "squadra1"; 
			}
		} else {
			// vince il primo giocatore
			vincitore = firstPlayer;
		}

		/* calcolo punti */
		int puntiPrima = puntiDaValore(primaCarta.value);
		int puntiSeconda = puntiDaValore(secondaCarta.value);
		int puntiMano = puntiPrima + puntiSeconda;

		if(vincitore == "squadra2"){
			puntisq2 += puntiMano;
			cout << "La mano e' vinta da SQUADRA 2 (BOT). Punti guadagnati: " << puntiMano <<endl;
		} else {
			puntisq1 += puntiMano;
			cout << "La mano e' vinta da SQUADRA 1. Punti guadagnati: " << puntiMano <<endl;
		}

		/* Il vincitore sarÃ  il primo a pescare e giocare nella prossima mano */
		firstPlayer = vincitore;
		cout << "Il vincitore " << vincitore << " sara' il primo a pescare e a giocare la prossima mano." <<endl;

		cout << "Punteggio attuale = Squadra1: " << puntisq1 << " e Squadra2: " << puntisq2 <<endl;

		/* chiedi se continuare */
		cout << "Vuoi giocare un'altra mano? (si / no): "<<endl;
		char c;
		cin >> c;
		if(c != 's' && c != 'S') break;
	}

	cout << "Partita terminata. Punteggio finale = Squadra1: " << puntisq1 << " / Squadra2: " << puntisq2 <<endl;
	if( puntisq1> puntisq2){
		cout<< " ha vinto la squadra 1 "<<endl;
	}
	else{
		cout<<" ha vinto la squadra 2 "<<endl;
	}
	return 0;
}

