#include <iostream>
#include <string>
#include <vector>
#include <algorithm> 
#include<ctime>
#include<cstdlib>


using namespace std;

struct mydata{
	int value;
	string segno;
};

int puntiDaValore(int v){
	if(v == 1) return 11;
	if(v == 3) return 10;
	if(v == 10) return 4;
	if(v == 9) return 3;
	if(v == 8) return 2;
	return 0;
}

void stampaCarta (const mydata &c){
	cout << c.value << " di " << c.segno;
}

int main(){
setlocale(LC_ALL, " ita ");
	int puntisq2 = 0;
	int puntisq1 = 0;
    
	// Prepara il mazzo da 40 carte (valori 1..10, 4 semi)
	vector<string> semi = {"coppe","denari","spade","bastoni"};
	vector<mydata> mazzo;
	for(const auto &s : semi){
		for(int v=1; v<=10; ++v){
			mazzo.push_back({v, s});
		}
	}

	// Mischia il mazzo
	std::mt19937 rng((unsigned)time(NULL));
	shuffle(mazzo.begin(), mazzo.end(), rng);

	// Distribuisci 3 carte a ciascuna mano
	vector<mydata> mano1, mano2; // mano1 = squadra1 (utente), mano2 = bot
	for(int i=1; i<4; ++i){
		mano1.push_back(mazzo.back()); mazzo.pop_back();
		mano2.push_back(mazzo.back()); mazzo.pop_back();
	}

	// La briscola è il seme della carta in cima al mazzo (se presente)
	string BRISCOLA = " ";
	if(!mazzo.empty()) BRISCOLA = mazzo.back().segno;
	cout << "BRISCOLA : " << BRISCOLA <<endl;

	string primo_giocatore = "squadra1"; // inizialmente squadra1 inizia

	while(!mano1.empty(),  !mano2.empty()){
		cout << "\n--- Nuova mano ---\n";
		cout << "Primo a giocare: " << primo_giocatore << " la BRISCOLA è : " << BRISCOLA <<endl;

		// Mostra mano utente
		cout << "La tua mano: \n";
		for(size_t i=0; i<mano1.size(); ++i){
			cout << i <<" ) "; stampaCarta(mano1[i]); cout << " vale " << puntiDaValore(mano1[i].value) << " punti "<<endl;
		} 

		mydata cartaPrima, cartaSeconda;
		bool primoagiocare = (primo_giocatore == "squadra1");

		if(primoagiocare){
			// utente gioca per primo
			int indice_carta;
			do{
				cout << "Scegli che carta giocare: "<<endl; 
				cin >> indice_carta;
			}while(indice_carta<1, indice_carta >= (int)mano1.size());
			cartaPrima = mano1[indice_carta];
			mano1.erase(mano1.begin()+indice_carta);

			// Bot risponde: gioca una carta casuale tra le sue
			int indice_cartabot = rand() % mano2.size();
			cartaSeconda = mano2[indice_cartabot];
			mano2.erase(mano2.begin()+indice_cartabot);
			cout << "Il bot risponde con: "; stampaCarta (cartaSeconda); cout << " che vale " << puntiDaValore(cartaSeconda.value) << " punti "<<endl;
		} else {
			// bot gioca per primo
			int indice_cartabot = rand() % mano2.size();
			cartaPrima = mano2[indice_cartabot];
			mano2.erase(mano2.begin()+indice_cartabot);
			cout << "Il bot gioca: "; stampaCarta (cartaPrima); cout << " che vale " << puntiDaValore(cartaPrima.value) << " punti "<<endl;

			// utente risponde
			int indice_carta;
			do{
				cout << "Scegli che carta giocare in risposta: "<<endl;
				cin >> indice_carta;
			}while(indice_carta<1, indice_carta >= (int)mano1.size());
			cartaSeconda = mano1[indice_carta];
			mano1.erase(mano1.begin()+indice_carta);
		}

		// Determina il vincitore basato su briscola e punti:
		bool primabriscola = (!BRISCOLA.empty() && cartaPrima.segno == BRISCOLA);
		bool secondabriscola = (!BRISCOLA.empty() && cartaSeconda.segno == BRISCOLA);
		int puntiPrima = puntiDaValore(cartaPrima.value);
		int puntiSeconda = puntiDaValore(cartaSeconda.value);

		string vincitore;
		// Se entrambe dello stesso seme (non necessariamente briscola), chi ha più punti vince
		if(cartaPrima.segno == cartaSeconda.segno){
			if(puntiSeconda > puntiPrima){
				// rispondente vince
				vincitore = primoagiocare ? "squadra2" : "squadra1";
			} else {
				// primo vince anche in caso di parità punti
				vincitore = primo_giocatore;
			}
		} else {
			// semi diversi
			if(primabriscola && !secondabriscola){
				// prima è briscola, secondo non puo' prendere
				vincitore = primo_giocatore;
			} else if(!primabriscola && secondabriscola){
				// secondo gioca briscola, puo' prendere solo se e' briscola e ha punti superiori
				if(puntiSeconda > puntiPrima) {
					vincitore = primoagiocare ? "squadra2" : "squadra1";
				} else {
					vincitore = primo_giocatore;
				}
			} else {
				// nessuna briscola, semi diversi => vince chi ha giocato per primo
				vincitore = primo_giocatore;
			}
		}

		int puntiMano = puntiPrima + puntiSeconda;
		if(vincitore == "squadra2"){
			puntisq2 += puntiMano;
			cout << "La mano e' vinta dalla SQUADRA 2 (BOT). Punti guadagnati: " << puntiMano <<endl;
		} else {
			puntisq1 += puntiMano;
			cout << "La mano e' vinta dalla SQUADRA 1 (TU). Punti guadagnati: " << puntiMano <<endl;
		}

		// Il vincitore pesca per primo (se ci sono carte nel mazzo)
		if(!mazzo.empty()){
			if(vincitore == "squadra1"){
				mano1.push_back(mazzo.back()); mazzo.pop_back();
				if(!mazzo.empty()){ mano2.push_back(mazzo.back()); mazzo.pop_back(); }
			} else {
				mano2.push_back(mazzo.back()); mazzo.pop_back();
				if(!mazzo.empty()){ mano1.push_back(mazzo.back()); mazzo.pop_back(); }
			}
		}

		// il vincitore sarà il primo a giocare nella prossima mano
		primo_giocatore = vincitore;
		cout << "Punteggio attuale = Squadra1: " << puntisq1 << " e Squadra2: " << puntisq2 <<endl;
	}

	cout << "Partita terminata. Punteggio finale = Squadra1: " << puntisq1 << " e Squadra2: " << puntisq2 <<endl;
	return 0;
}

