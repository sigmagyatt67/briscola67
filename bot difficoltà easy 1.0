#include <iostream>
#include <string>
#include <vector>
#include <algorithm> 
#include<ctime>
#include<cstdlib>


using namespace std;

struct mydata{
	int value;
	string segno;
};

int puntiDaValore(int v){
	if(v == 1) return 11;
	if(v == 3) return 10;
	if(v == 10) return 4;
	if(v == 9) return 3;
	if(v == 8) return 2;
	return 0;
}

void stampaCarta(const mydata &c){
	cout << c.value << " di " << c.segno;
}

int main(){
	setlocale(LC_ALL, " ita ");
	int puntisq2 = 0;
	int puntisq1 = 0;
    
	// Prepara il mazzo da 40 carte (valori 1..10, 4 semi)
	vector<string> semi = {"coppe","denari","spade","bastoni"};
	vector<mydata> mazzo;
	for(const auto &s : semi){
		for(int v=1; v<=10; ++v){
			mazzo.push_back({v, s});
		}
	}

	// Mischia il mazzo
	std::mt19937 rng((unsigned)time(NULL));
	shuffle(mazzo.begin(), mazzo.end(), rng);

	// Distribuisci 3 carte a ciascuna mano
	vector<mydata> mano1, mano2; // mano1 = squadra1 (utente), mano2 = bot
	for(int i=0;i<3;++i){
		mano1.push_back(mazzo.back()); mazzo.pop_back();
		mano2.push_back(mazzo.back()); mazzo.pop_back();
	}

	// La briscola è il seme della carta in cima al mazzo (se presente)
	string briscola = " ";
	if(!mazzo.empty()) briscola = mazzo.back().segno;
	cout << "Briscola : " << briscola <<endl;

	string firstPlayer = "squadra1"; // inizialmente squadra1 inizia

	while(!mano1.empty() || !mano2.empty()){
		cout << "\n--- Nuova mano ---\n";
		cout << "Primo a giocare: " << firstPlayer << " la briscola è : " << briscola <<endl;

		// Mostra mano utente
		cout << "La tua mano: \n";
		for(size_t i=0;i<mano1.size();++i){
			cout << i << ") "; stampaCarta(mano1[i]); cout << " (" << puntiDaValore(mano1[i].value) << " punti)"<<endl;
		}

		mydata cartaPrima, cartaSeconda;
		bool firstIsUser = (firstPlayer == "squadra1");

		if(firstIsUser){
			// utente gioca per primo
			int idx;
			do{
				cout << "Scegli indice carta da giocare: "; cin >> idx;
			}while(idx<0 || idx >= (int)mano1.size());
			cartaPrima = mano1[idx];
			mano1.erase(mano1.begin()+idx);

			// Bot risponde: gioca una carta casuale tra le sue
			int idxb = rng() % mano2.size();
			cartaSeconda = mano2[idxb];
			mano2.erase(mano2.begin()+idxb);
			cout << "Il bot risponde con: "; stampaCarta(cartaSeconda); cout << " (" << puntiDaValore(cartaSeconda.value) << " punti)"<<endl;
		} else {
			// bot gioca per primo
			int idxb = rng() % mano2.size();
			cartaPrima = mano2[idxb];
			mano2.erase(mano2.begin()+idxb);
			cout << "Il bot gioca: "; stampaCarta(cartaPrima); cout << " (" << puntiDaValore(cartaPrima.value) << " punti)"<<endl;

			// utente risponde
			int idx;
			do{
				cout << "Scegli indice carta da giocare in risposta: "; cin >> idx;
			}while(idx<0 || idx >= (int)mano1.size());
			cartaSeconda = mano1[idx];
			mano1.erase(mano1.begin()+idx);
		}

		// Determina il vincitore basato su briscola e punti:
		bool primaEbriscola = (!briscola.empty() && cartaPrima.segno == briscola);
		bool secondaEbriscola = (!briscola.empty() && cartaSeconda.segno == briscola);
		int puntiPrima = puntiDaValore(cartaPrima.value);
		int puntiSeconda = puntiDaValore(cartaSeconda.value);

		string winner;
		// Se entrambe dello stesso seme (non necessariamente briscola), chi ha più punti vince
		if(cartaPrima.segno == cartaSeconda.segno){
			if(puntiSeconda > puntiPrima){
				// rispondente vince
				winner = firstIsUser ? "squadra2" : "squadra1";
			} else {
				// primo vince anche in caso di parità punti
				winner = firstPlayer;
			}
		} else {
			// semi diversi
			if(primaEbriscola && !secondaEbriscola){
				// prima è briscola, secondo non puo' prendere
				winner = firstPlayer;
			} else if(!primaEbriscola && secondaEbriscola){
				// secondo gioca briscola -> puo' prendere solo se e' briscola e ha punti superiori
				if(puntiSeconda > puntiPrima) {
					winner = firstIsUser ? "squadra2" : "squadra1";
				} else {
					winner = firstPlayer;
				}
			} else {
				// nessuna briscola, semi diversi => vince chi ha giocato per primo
				winner = firstPlayer;
			}
		}

		int puntiMano = puntiPrima + puntiSeconda;
		if(winner == "squadra2"){
			puntisq2 += puntiMano;
			cout << "La mano e' vinta da SQUADRA 2 (BOT). Punti guadagnati: " << puntiMano <<endl;
		} else {
			puntisq1 += puntiMano;
			cout << "La mano e' vinta da SQUADRA 1. Punti guadagnati: " << puntiMano <<endl;
		}

		// Il vincitore pesca per primo (se ci sono carte nel mazzo)
		if(!mazzo.empty()){
			if(winner == "squadra1"){
				mano1.push_back(mazzo.back()); mazzo.pop_back();
				if(!mazzo.empty()){ mano2.push_back(mazzo.back()); mazzo.pop_back(); }
			} else {
				mano2.push_back(mazzo.back()); mazzo.pop_back();
				if(!mazzo.empty()){ mano1.push_back(mazzo.back()); mazzo.pop_back(); }
			}
		}

		// il vincitore sarà il primo a giocare nella prossima mano
		firstPlayer = winner;
		cout << "Punteggio attuale= Squadra1: " << puntisq1 << " e Squadra2: " << puntisq2 <<endl;
	}

	cout << "Partita terminata. Punteggio finale= Squadra1: " << puntisq1 << " e Squadra2: " << puntisq2 <<endl;
	return 0;
}
